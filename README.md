# Welcome to OAuth-Authenticator!

The purpose of the project to decrypt an id token generated by Azure Active Directory.

# Technology
The project is written in go. It exposes a REST webservice where 2 POST parameters were passed.


# API endpoints:
/validateToken: It validate the token as and find the signing key responsible to decrypt the token.
/: This is a heartbeat endpoint.

## Request String Structure
/validateToken gets a request string in JSON format, which needs to have 2 fields: 
Token: The ID token/refresh token you are passing
Config: The link for the open id configuration
{
	"Token":"eyJ0eXAiOiJKV1QiLCpZCI6IlNzWnNCTmhaY0YzUTlTNHRycFFCVEJ5TlJSSSJ9.eyJhdWQiOiI5NDcwNjBlNy0yMWY5LTQwMzQtODNmZi0xYWQ2NzMwZTk5NWEiLCJpc3MiOiJodHRwczovL2xvZ2luLm1pY3Jvc29mdG9ubGluZS5jb20vMGViMDNhNjktMTU5OC00ZGMyLWJkNjktMDM1YTE2ZTcwNWNjL3YyLjAiLCJpYXQiOjE1OTE0NTAxODYsIm5iZiI6MTU5MTQ1MDE4NiwiZXhwIjoxNTkxNDU0MDg2LCJhaW8iOiJBVVFBdS84UEFBQUFTc2tKZm9QK2xSdnZrTDZBMkZXZFJaQmZmdXNXN2hhM0NVWnJRdURsZHd3YnpwcHZBY2NiSmJML2YrYjVMOW5ESVNmOU84R2UvMUJsWjZoUDd2VHM5dz09IiwiYXV0aF90aW1lIjoxNTkxNDUwNDQ2LCJub25jZSI6ImRlZmF1bHROb25jZSIsInN1YiI6IlVfNTdmT0RTZjR4TTFwbnhEQWhSc2lRSHgzT25MQ2lKajRVUXppYUV5aUEiLCJ0aWQiOiIwZWIwM2E2OS0xNTk4LTRkYzItYmQ2OS0wMzVhMTZlNzA1Y2MiLCJ1dGkiOiJPUXV1NHIwREQwaUNRSnZUWmpKTUFBIiwidmVyIjoiMi4wIn0.abcyPflv74PsqfH6pTiC09mRrnk6GFVjxBOK5lOk4l9NHHewXGsuQZkG-Ww6YgzS2JaSwRsUqAbLKVC4NgVL_ocij7HVxNkZ8MxCthKAfRG8Fb2wvf4NPPbt2oq5jFE4NlOYR8TDHeLEnQvdFYQTfjzswmrDhG6oJ0D0CGu43wCGTIZt1MaFm6fTegKt20IpaOwkd9N5F8cSw_ekTya6V0MWab6QVbbtAXUy1XpQ-QVz89u7Lr-cPK1sLLxOvLlsmetpcRdR0fHYUvzTrirnqlizD0bXENpINRhangQDfsULpfWi_IBnSB1IfqBtdkvmsqzJS6ABLqq1MLUrzHSwaQ&session_state=6cf1687e-28d3-4894-a5eb-cfacaf604199",
	"Config":"https://login.microsoftonline.com/00000000-035a16e705cc/v2.0/.well-known/openid-configuration"
}

## Response String Structure

In response, you get a JSON response of the KID associated with the oauth token and related signing key to decrypt the token. An example of response is:
{

"Kid":  "SsZsBNhZcF3Q9S4trpQBTByNRRI",

"SigningKey":  "uHPewhg4WC3eLVPkEFlj7RDtaKYWXCI5G-LPVzsMKOuIu7qQQbeytIA6P6HT9_iIRt8zNQvuw4P9vbNjgUCpI6vfZGsjk3XuCVoB_bAIhvuBcQh9ePH2yEwS5reR-NrG1PsqzobnZZuigKCoDmuOb_UDx1DiVyNCbMBlEG7UzTQwLf5NP6HaRHx027URJeZvPAWY7zjHlSOuKoS_d1yUveaBFIgZqPWLCUSSrMSR-SHFT7Hy1XjbVXpHJHNNAXpPoGoWXTuc0BxMsB4cqjfJqoftFGOG4x32vEzakArLPxAKwGvkvu0jToAyvSQ"

}

## How to run this code


This URL prrovides good documentation, how to install GO in your development environment.
https://golang.org/doc/install and if you don't have classpath settings, make sure you setup your classpath pointing to go executables.

You can use any standard editor like GoLand or VSCode as an IDE writing code and debugging.

Once you install go; get this project either by downloading the zip file or git pull.
Once downloaded, go into the folder oauth-token-validator/resources. You will get a file named config there. This is the config file for this project. It's really simple and change this according to your need. Currently the fields are:

url=outh.aad.universal.org  
httpPort=80  
httpsPort=443  
username=svcaccountUser  
password=svcaccountPassword  
logFileLocation=/Users/arka.ghosh/logs  
logLevel=TRACE  
environment=sandbox  
certFile=cert.pem  
keyFile=key.pem  
debugPort=8787  
banner=Please enter your username and password for this site  
version=0.1

You can add as many as new fields in this file and refer them from your code; check utils.go for this.

Once configuration is done, run:
$go build
$./oauth-token-validator

Once you run this code, endpoint will be up accordingly. For example based on the above configuration 2 endpoints will be up:

http://outh.aad.universal.org/validateToken
http://outh.aad.universal.org/

http://localhost/validateToken
http://localhost/

You can also enable https by tweaking a little code. Check router.go.

If you want use your domain, you should change config file to add your vhost.

## TODO

- Create an endpoint which can take Token and OpenID configuration and provide you the user details along with group association in a JSON format.
- Dockerize this code.


## About me
I have written this code with many help from go official documentation and discussion threads on StackOverflow.com. 

I started learning GO few days back and liked the flexibility of this language. As a rookie, I expect there would be lot of coding errors. Hence, please review and provide constructive feedback on this code as your time permits.


You can reach out to me at:  https://www.linkedin.com/in/arkapghosh or skype: arkaprava.ghosh@hotmail.com